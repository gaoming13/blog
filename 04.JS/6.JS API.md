### Atomics
```js
const workerScriptBlobUrl = URL.createObjectURL(new Blob([`
  self.onmessage = ({data}) => {
    const view = new Uint32Array(data);
    for (let i = 1; i <= 1000; i++) {
      // view[0] += 1;
      // åŸå­æ“ä½œ
      Atomics.add(view, 0, 1);
    }
  };
`]));
const buffer = new SharedArrayBuffer(4);
const view = new Uint32Array(buffer); view[0] = 0;
for (let i = 1; i <= 10; i++) {
  const woker = new Worker(workerScriptBlobUrl);
  woker.postMessage(buffer);
}
setTimeout(() => console.log(view[0]), 1000);
```
- å¤šä¸ªä¸Šä¸‹æ–‡è®¿é—® SharedArrayBuffer æ—¶,åŒæ—¶å¯¹ç¼“å†²åŒºæ‰§è¡Œæ“ä½œ,å¯èƒ½å‡ºç°èµ„æºäº‰ç”¨é—®é¢˜
- Atomicsé€šè¿‡å¼ºåˆ¶åŒä¸€æ—¶åˆ»åªèƒ½å¯¹ç¼“å†²åŒºæ‰§è¡Œä¸€ä¸ªæ“ä½œ

### è·¨ä¸Šä¸‹æ–‡æ¶ˆæ¯
```js
const iframeWin = document.querySelector('iframe').contentWindow;
iframeWin.postMessage({a: 123, b: 456}, '*');
```
- ç®€ç§° XDM(cross-document messaging),ä¸€ç§åœ¨ä¸åŒæ‰§è¡Œä¸Šä¸‹æ–‡(ä¸åŒå·¥ä½œçº¿ç¨‹/ä¸åŒæºçš„é¡µé¢)é—´ä¼ é€’ä¿¡æ¯çš„èƒ½åŠ›
- postMessage(æ¶ˆæ¯, ç›®æ ‡æ¥æ”¶æºçš„å­—ç¬¦ä¸²);

### Encoding API
- ç”¨äºå­—ç¬¦ä¸²ä¸å®šå‹æ•°ç»„ä¹‹é—´çš„è½¬æ¢
- æ–‡æœ¬ç¼–ç 
  - æ‰¹é‡ç¼–ç 
    - TextEncoder.prototype.encode(å­—ç¬¦ä¸²)
      ```js
      const textEncoder = new TextEncoder();
      textEncoder.encode('ğŸ˜„fä¸­');
      // Uint8Array(8)Â [240, 159, 152, 132, 102, 228, 184, 173]
      encodeURIComponent('ğŸ˜„fä¸­');
      // %F0%9F%98%84 f %E4%B8%AD
      // parseInt('F0', 16) = 240 = 11110000
      // parseInt('9F', 16) = 159 = 10011111
      // parseInt('98', 16) = 152 = 10011000
      // parseInt('84', 16) = 132 = 10000100
      // 'f'.codePointAt()  = 102 = 01100110
      // parseInt('E4', 16) = 228 = 11100100
      // parseInt('B8', 16) = 184 = 10111000
      // parseInt('AD', 16) = 173 = 10101101
      ```
    - TextEncoder.prototype.encodeInto(å­—ç¬¦ä¸², ç›®æ ‡Unit8Array)
      ```js
      const textEncoder = new TextEncoder();
      const arr = new Uint8Array(3);
      const res = textEncoder.encodeInto('fä¸­', arr);
      // res: {read: 1, written: 1}
      // arr: Uint8Array(3)Â [102, 0, 0]
      ```
  - æµç¼–ç 
    - TextEncoderStream å°†è§£ç åçš„æ–‡æœ¬æµé€šè¿‡ç®¡é“è¾“å…¥æµç¼–ç å™¨å¾—åˆ°ç¼–ç åæ–‡æœ¬å—çš„æµ
    ```js
    async function * chars() {
      const decodedText = 'foo';
      for (let char of decodedText) {
        yield await new Promise((resolve) => {
          setTimeout(resolve, 1000, char);
        });
      }
    }
    // æ–‡æœ¬æµ
    const textStream = new ReadableStream({
      async start(constroller) {
        for await (const v of chars()) {
          constroller.enqueue(v);
        }
        constroller.close();
      }
    });
    // ç¼–ç åæ–‡æœ¬å—çš„æµ
    const encodeTextStream = textStream.pipeThrough(new TextEncoderStream());
    // è¯»å–æ–‡æœ¬å—æµ
    const reader = encodeTextStream.getReader();
    (async () => {
      while(true) {
        const res = await reader.read();
        if (res.done) break;
        console.log(res);
      }
    })();
    ```
- æ–‡æœ¬è§£ç 
  - ä¸ç¼–ç å™¨ç±»ä¸åŒï¼Œåœ¨å°†å®šå‹æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ—¶ï¼Œè§£ç å™¨æ”¯æŒéå¸¸å¤šçš„å­—ç¬¦ä¸²ç¼–ç (é»˜è®¤UTF-8)
  - æ‰¹é‡è§£ç 
    ```js
    const textDecoder = new TextDecoder('utf-8');
    textDecoder.decode(Uint8Array.of(102, 111, 111)); // foo
    ```
  - æµè§£ç 
    - å°†ç¼–ç åçš„æ–‡æœ¬æµé€šè¿‡ç®¡é“ è¾“å…¥æµè§£ç å™¨ä¼šå¾—åˆ°è§£ç åæ–‡æœ¬å—çš„æµ
    - è§£ç å™¨æµä¼šä¿æŒå—ç‰‡æ®µæŒ‡å¯¼å–åˆ°å®Œæ•´çš„å­—ç¬¦
    ```js
    async function* chars() {
      for (const u8 of [240, 159, 152, 132, 102, 228, 184, 173]) {
        yield await new Promise((resolve) => setTimeout(resolve, 100, Uint8Array.of(u8)));
      }
    }
    // æ–‡æœ¬æµ
    const textStream = new ReadableStream({
      async start(constroller) {
        for await (const u8 of chars()) {
          constroller.enqueue(u8);
        }
        constroller.close();
      }
    });
    // æµè¿‡ç®¡é“è§£ç 
    const decodeTextStream = textStream.pipeThrough(new TextDecoderStream());
    // è¯»å–
    const reader = decodeTextStream.getReader();
    (async () => {
      while(true) {
        const res = await reader.read();
        if (res.done) break;
        console.log(res);
      }
    })();
    ```




> https://developer.mozilla.org/zh-CN/docs/Web/API/Performance_API
### Performance API é«˜é‡‡æ ·ç‡
- å…¨å±€å˜é‡ performance æ˜¯ Performance çš„å®ä¾‹å¯¹è±¡
- åŸå‹å±æ€§(Performance.prototype)
  - performance.timing è¿”å›ä¸€ä¸ª PerformanceTiming å¯¹è±¡, ä¸å»¶æ—¶ç›¸å…³çš„æ€§èƒ½ä¿¡æ¯
  - performance.navigation
- åŸå‹æ–¹æ³•(Performance.prototype) è¿”å›ä¸€ä¸ª PerformanceNavigation å¯¹è±¡, åœ¨ç»™å®šæµè§ˆä¸Šä¸‹æ–‡ä¸­å‘ç”Ÿçš„å¯¼èˆªç±»å‹
  - performance.now() è¿”å›åˆ›å»ºæµè§ˆå™¨ä¸Šä¸‹æ–‡çš„æ—¶é—´(å•ä½ms,ç²¾ç¡®åˆ°5uså¾®ç§’)
  - performance.getEntries({name: "entry_name", entryType: "mark"}) ç­›é€‰è·å– PerformanceEntry æ•°ç»„
  - performance.mark('æ ‡è®°1') åˆ›å»ºæ ‡è®°
  - performance.mark('æ ‡è®°2') åˆ›å»ºæ ‡è®°
  - performance.measure('é—´è·1', 'æ ‡è®°1', 'æ ‡è®°2');
  - performance.getEntriesByName('é—´è·1')[0].duration;
  - performance.clearMarks() åˆ é™¤æ‰€æœ‰æ ‡è®°
  - performance.clearMeasures() åˆ é™¤æ‰€æœ‰æµ‹é‡

### PerformanceEntry
- ä»£è¡¨äº† performance æ—¶é—´åˆ—è¡¨ä¸­æ¯ä¸ª metric æ•°æ®
- å¯æ‰‹åŠ¨æ„å»º mark æˆ– measure ä¸»åŠ¨ç”Ÿæˆ
- åœ¨èµ„æºåŠ è½½çš„æ—¶å€™, ä¹Ÿä¼šè¢«åŠ¨ç”Ÿæˆ(å¦‚å›¾ç‰‡ã€jsã€cssç­‰èµ„æºåŠ è½½)
- åŸå‹å±æ€§
  - name åå­—
  - entryType ä¸ŠæŠ¥ç±»å‹(frameã€navigationã€resourceã€markã€measureã€paint)
  - startTime ä¸ŠæŠ¥å¼€å§‹çš„æ—¶é—´(ms)
  - duration è€—æ—¶(ms)