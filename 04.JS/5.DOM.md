## 文档对象模型(DOM, Document Object Model)
- 通过 DOM API 可以添加、删除、修改页面元素
- DOM中共有12种节点类型，都继承至基本类型 Node
- 浏览器并不支持所有的节点类型，常用的是 元素节点和文本节点

### Node类型
- Node.prototype.nodeType 节点的类型
  - Node.prototype.ELEMENT_NODE: 1
  - Node.prototype.ATTRIBUTE_NODE: 2
  - Node.prototype.TEXT_NODE: 3
  - Node.prototype.CDATA_SECTION_NODE: 4
  - Node.prototype.ENTITY_REFERENCE_NODE: 5
  - Node.prototype.ENTITY_NODE: 6
  - Node.prototype.PROCESSING_INSTRUCTION_NODE: 7
  - Node.prototype.COMMENT_NODE: 8
  - Node.prototype.DOCUMENT_NODE: 9
  - Node.prototype.DOCUMENT_TYPE_NODE: 10
  - Node.prototype.DOCUMENT_FRAGMENT_NODE: 11
  - Node.prototype.NOTATION_NODE: 12
- Node.prototype.nodeName 节点的标签名
- Node.prototype.nodeValue
- 节点的关系节点(只读)
  - Node.prototype.childNodes 节点的子节点,包括换行空格(NodeList的实例，类数组)
  - Node.prototype.firstChild 节点的第一个子节点
  - Node.prototype.lastChild 节点的最后一个子节点
  - Node.prototype.parentNode 节点的父节点
  - Node.prototype.previousSibling 节点上面的兄弟节点
  - Node.prototype.nextSibling 节点下面的兄弟节点
- 操作节点的方法
  - `pNode.appendChild(newNode:新节点)` 把 newNode 移动到 pNode 的最后一个子节点
  - `pNode.insertBefore(newNode:新节点, node2:参照节点)` 把 newNode 移动到 pNode的子节点node2前面
  - `pNode.replaceBefore(newNode:新节点, node2:参照节点)` 把 newNode 替换 pNode的子节点node2
  - `pNode.removeChild(node2)` 删除 pNode的子节点node2
  - `node1.cloneNode(?deep:是否深复制)` 复制节点 node1
    - 不会复制添加到节点的JS属性，比如事件处理程序，只复制HTML属性
    - deep=true 复制节点整个DOM树
    - deep=false 只复制调用该方法的节点
- Document 类型
  - nodeType=9
  - 原型链：Object < EventTarget < Node < Document < HTMLDocument < document
  - HTMLDocument.prototype.title 标题,可修改
  - HTMLDocument.prototype.domain 域名,可修改
  - HTMLDocument.prototype.referrer 来源,只读
  - HTMLDocument.prototype.URL 链接,只读
  - Document.prototype.getElementById(elementId)
  - Document.prototype.getElementsByTagName(localName) 返回 HTMLCollection 类型
  - Document.prototype.getElementsByName(elementName) 返回 NodeList 类型
  - Document.prototype.createElement(localName, ?option) 创建新元素
  - Document.prototype.createTextNode(data) 创建文本元素
- Element 类型
  - nodeType=1
  - 原型链：Object < EventTarget < Node < Element < HTMLElement < HTMLBodyElement < document.body
  - 原型链：Object < EventTarget < Node < Element < HTMLElement < HTMLInputElement < input
  - $0.id 元素的id属性(唯一标识符),可修改
  - $0.title 元素的title属性,可修改
  - $0.className 元素的class属性,可修改
  - $0.attributes 属性集合(NamedNodeMap类型)
  - $0.getAttribute(name) 获取属性
  - $0.setAttribute(name, value) 设置属性
  - $0.removeAttribute(name) 移除属性
- Text 类型
  - nodeType=3
  - 原型链：Object < EventTarget < Node < CharacterData < Text
  - Text.prototype.appendData(text) 向节点末尾添加文本
  - Text.prototype.deleteData(offset, count) 从offset位置开始，删除count个字符
  - Text.prototype.insertData(offset, text) 从offset位置开始，插入文本元素
  - Text.prototype.replaceData(offset, count, text) 从offset位置开始，替换文本元素
  - Text.prototype.splitText(offset) 在位置 offset 处， 拆分成2个文本节点
  - Text.prototype.substringData(offset, count) 提取字符串
  - 规范化文本节点
    - Node.prototype.normalize() 在父节点上调用，所有子节点的同胞文本节点合并
      - 浏览器在解析文档时，永远不会创建同胞文本节点
      - 同胞文本节点只会出现在 DOM脚本 生成的文档树中
    - Text.prototype.splitText(offset) 拆分文本节点
- Comment 类型
  - nodeType=8
  - 原型链：Object < EventTarget < Node < CharacterData < Comment
- CDATASection 类型
  - nodeType=4
  - `<div id="myDiv"><![CDATA[This is some content.]]></div>`
  - CDATA区块只在XML中有效
- DocumentType 类型
  - nodeType=10
  - 原型链：Object < EventTarget < Node < DocumentType

### MutationObserver API(新)
- 可在DOM被修改时异步执行回调，可观察整个文档、DOM树的一部分、某个元素的属性、文本
- 每个回调都会收到一个 MutationRecord
- disconnect() 提前终止回调
- 调用 disconnect() 并不会结束 MutaionObserver，还可以继续 observe()

## DOM扩展
- 虽然DOM规定了与 XML 和 HTML 文档交互的核心 API
- 但其它几个规范也定义了对 DOM 的扩展
- 很多扩展都是基于之前的已成为事实标准的转悠特性标准化而来

### 选择器 Selectors API(新)
- 通过浏览器原生支持这个 API,解析和遍历 DOM树可以通过底层编译语言实现，性能也有数量级的提升
```js
// 跟 jQuery 选择器类似
document.querySelectorAll('#aaa')
document.querySelectorAll('[name="input1"]')
document.body.matches('body.body')
```
- querySelector
  - 匹配改模式的第一个后代元素, 没有就返回null
  - $0.querySelector(selectors:选择器)
- querySelectorAll
  - 匹配改模式的所有后代元素(NodeList类型)
  - $0.querySelectorAll(selectors:选择器)
- matches
  - 接收一个 CSS 选择符参数，如果元素匹配则返回 true, 否则返回 false
  - $0.matches(selectors:选择器)

### 元素遍历 Element Traversal API(新)
- IE9之前的版本不会把元素间的空格当成空白节点，而其他浏览器则会
- 为了拟补这个差异，同时不影响 DOM 规范，W3C通过了新的 Element Traversal 规范定义了一组新属性
- $0.childElementCount 返回子元素数量(不包括文本节点和注释)
- $0.firstElementChild 返回第一个Element类型的子元素
- $0.lastElementChild 返回最后一个Element类型的子元素
- $0.previousElementSibling 返回前一个 Element 类型的同胞元素
- $0.nextElementSibling 返回后一个 Element 类型的同胞元素

### HTML5
- CSS类扩展
  - $0.getElementsByClassName(classNames) 返回类名中包含响应类的元素(NodeList类型)
  - $0.classList 可以通过 classList 属性操作元素的 class
    - $0.classList.add(...tokens) 添加多个 value
    - $0.classList.contains(token) 返回布尔值，给定的 value 是否存在
    - $0.classList.remove(...tokens) 移除多个 value
    - $0.classList.toggle(token, ?force) 有则删除，没有则添加
- 焦点管理
  - 查询文档是否获得了焦点
    - document.hasFocus() 返回布尔值，表示文档是否拥有焦点
  - 查询文档哪个元素拥有焦点
    - document.activeElement 当前拥有焦点的DOM元素
    - 默认情况下，页面刚加载完会设置为 document.body, 没加载完为 null
- HTMLDocument 扩展
  - document.readyState 文档加载状态：loading表示文档正在加载 / complete表示文档加载完成
  - document.compatMode 文档当前渲染模式：CSS1Compat标准模式 / BackCompat混杂模式
  - document.head 指向文档的 head 元素
- 字符集属性
  - document.characterSet 文档使用的字符集，可以通过meta元素或响应头来修改
- 自定义数据属性
  - 给元素指定非标准的属性，data-xxx 格式
  - 通过 $0.dataset 访问和设置
- 插入标记
  - $0.innerHTML
  - $0.outerHtml
  - $0.insertAdjacentHTML(positon:位置, text:HTML)
  - $0.insertAdjacentText(where:位置, data:文本)
    - 位置：beforebegin / afterbegin / beforend / afterend
- scrollIntoView()
  - 滚动浏览器窗口或容器元素以便包含元素进入视口
  - $0.scrollIntoView(alignToTop = true) 参数：true元素的顶部与视口顶部对齐 / false元素的底部与视口底部对齐
  - $0.scrollIntoView({behavior: 'auto', block: 'start', inline: nearest})
      - behavior 过度动画：smooth / auto
      - block 垂直方向的对齐：start / center / end / nearest
      - inline 水平方向的对齐：start / center / end / nearest

### 专有拓展
- 某些浏览器为了弥补功能缺失而为 DOM 添加专有的扩展
- $0.children 元素Element类型的子节点
- $0.contains(other) 元素是否包含了一个后代元素
- $0.innerText 对应元素子树的所有文本内容
- $0.outerText

## DOM2 和 DOM3
- DOM1(DOM Level 1) 主要定义了 HTML 和 XML 文档的底层结构
- DOM2 和 DOM3 在这些结构之上加入更多交互能力，提供了更高级的 XML 特性
- 在DOM2中
  - Node类型包含以下特定于命名空间的属性
    - $0.localName 不包含命名空间前缀的节点名
    - $0.namespaceURI 节点的命名空间URL,未指定则为 null
    - $0.prefix 命名空间前缀,未指定泽伟 null
    - 在节点使用命名空间前缀的情况下：nodeName = `prefix:localName`
  - Docuemnt的变化
    - `document.createAttributeNS(namespaceURI, tagName)` 以给定的标签名tagName创建指定命名空间的一个新元素
    - `document.createAttributeNS(namespaceURI, attributeName)` 以给定的属性名attributeName创建指定命名空间的一个新属性
    - `document.getElementsByTagNameNS(namespaceURI, tagName)` 返回指定命名空间 namespaceURI中所有标签名为 tagName 的元素
      - `document.getElementsByTagNameNS('http://www.w3.org/2000/svg', '*')` 获取所有svg元素
  - Element的变化
    - `$0.getAttributeNS(namespaceURI, localName)` 返回指定命名空间中名为 localName 的属性
    - `$0.getAttributeNodeNS(namespaceURI, localName)` 返回指定命名空间中名为 localName 的属性节点
    - `$0.getElementsByTagNameNS(namespaceURI, tagName)` 返回指定命名空间 namespaceURI中所有标签名为 tagName 的元素
    - `$0.hasAttributeNS(namespaceURI, localName)` 返回布尔值，是否拥有命名空间下的 localName 属性
    - `$0.removeAttributeNS(namespaceURI, localName)` 删除指定命名空间下的 localName 属性
    - `$0.setAttributeNS(namespaceURI, qualifiedName, value)` 设置指定命名空间下的 localName 属性
    - `$0.setAttributeNodeNS(attNode)` 设置指定命名空间下的属性节点

- 在DOM3中, 增加了与命名空间相关的方法
  - `$0.isDefaultNamespace(nameSpaceURI)` 返回布尔值,表示uri是否为节点的默认命名空间
  - `$0.lookupNamespaceURI(prefix)` 返回给定 prefix 的命名空间 URI
  - `$0.lookupPrefix(namespaceURI)` 返回给定 URI 的前缀
